<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Customizable user-data wrappers."><title>gdnative::export::user_data - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-9d5ec5f3536319c6.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="gdnative" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-nightly (1d68e6dd1 2024-09-21)" data-channel="nightly" data-search-js="search-0cfde64e8ad3a7fe.js" data-settings-js="settings-7e3bb6c46e92e77c.js" ><script src="../../../static.files/storage-29b1d5a9048d38fe.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-59a36e46ca746814.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-40f72c9259523cb3.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../../gdnative/index.html"><img src="https://github.com/godot-rust/gdnative/raw/master/assets/godot-ferris.svg" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../../gdnative/index.html"><img src="https://github.com/godot-rust/gdnative/raw/master/assets/godot-ferris.svg" alt="logo"></a><h2><a href="../../../gdnative/index.html">gdnative</a><span class="version">0.11.3</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module user_<wbr>data</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#nativeclass-and-user-data" title="`NativeClass` and user-data"><code>NativeClass</code> and user-data</a></li><li><a href="#choosing-a-wrapper-type" title="Choosing a wrapper type">Choosing a wrapper type</a></li><li><a href="#which-wrapper-to-use" title="Which wrapper to use?">Which wrapper to use?</a><ul><li><a href="#use-a-mutexdatat-when" title="Use a `MutexData&#60;T&#62;` when:">Use a <code>MutexData&lt;T&gt;</code> when:</a></li><li><a href="#use-a-rwlockdatat-when" title="Use a `RwLockData&#60;T&#62;` when:">Use a <code>RwLockData&lt;T&gt;</code> when:</a></li><li><a href="#use-a-arcdatat-when" title="Use a `ArcData&#60;T&#62;` when:">Use a <code>ArcData&lt;T&gt;</code> when:</a></li><li><a href="#use-a-localcelldatat-when" title="Use a `LocalCellData&#60;T&#62;` when:">Use a <code>LocalCellData&lt;T&gt;</code> when:</a></li><li><a href="#use-aethert-when" title="Use `Aether&#60;T&#62;` when:">Use <code>Aether&lt;T&gt;</code> when:</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In gdnative::<wbr>export</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">gdnative</a>::<wbr><a href="../index.html">export</a>::<wbr><a class="mod" href="#">user_data</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Customizable user-data wrappers.</p>
<h3 id="nativeclass-and-user-data"><a class="doc-anchor" href="#nativeclass-and-user-data">§</a><code>NativeClass</code> and user-data</h3>
<p>In Godot Engine, scripted behavior is attached to base objects through “script instances”:
objects that store script state, and allow dynamic dispatch of overridden methods. GDNative
exposes this to native languages as a <code>void *</code> pointer, known as “user-data”, that may point
to anything defined by the native library in question.</p>
<p>Godot is written in C++, and unlike Rust, it doesn’t have the same strict reference aliasing
constraints. This user-data pointer can be aliased mutably, and called freely from different
threads by the engine or other scripts. Thus, to maintain safety, wrapper types are to be used
to make sure that the Rust rules for references are always held for the <code>self</code> argument, and
no UB can occur because we freed <code>owner</code> or put another script on it.</p>
<h3 id="choosing-a-wrapper-type"><a class="doc-anchor" href="#choosing-a-wrapper-type">§</a>Choosing a wrapper type</h3>
<p>The default user data wrapper used by derive macro, when no <code>user_data</code> attribute is present,
is defined as the type alias <code>DefaultUserData&lt;T&gt;</code>. Currently, it is <code>LocalCellData&lt;T&gt;</code>. This
may change in the future, and changes to it will not be considered breaking changes.</p>
<p>To choose another wrapper type, put the <code>#[user_data]</code> attribute on your <code>NativeScript</code> type
if you are using the derive macro:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="attr">#[derive(NativeClass)]
#[inherit(gdnative::api::Node)]
#[user_data(gdnative::export::user_data::MutexData&lt;HelloWorld&gt;)]
</span><span class="kw">struct </span>HelloWorld;</code></pre></div>
<p>…or, if you are implementing <code>NativeScript</code> manually, set the <code>UserData</code> associated type
to the type you choose.</p>
<h3 id="which-wrapper-to-use"><a class="doc-anchor" href="#which-wrapper-to-use">§</a>Which wrapper to use?</h3><h4 id="use-a-mutexdatat-when"><a class="doc-anchor" href="#use-a-mutexdatat-when">§</a>Use a <code>MutexData&lt;T&gt;</code> when:</h4>
<ul>
<li>You don’t want to handle locks explicitly.</li>
<li>Your <code>NativeClass</code> type is only <code>Send</code>, but not <code>Sync</code>.</li>
</ul>
<h4 id="use-a-rwlockdatat-when"><a class="doc-anchor" href="#use-a-rwlockdatat-when">§</a>Use a <code>RwLockData&lt;T&gt;</code> when:</h4>
<ul>
<li>You don’t want to handle locks explicitly.</li>
<li>Some of your exported methods take <code>&amp;self</code>, and you don’t need them to be exclusive.</li>
<li>Your <code>NativeClass</code> type is <code>Send + Sync</code>.</li>
</ul>
<h4 id="use-a-arcdatat-when"><a class="doc-anchor" href="#use-a-arcdatat-when">§</a>Use a <code>ArcData&lt;T&gt;</code> when:</h4>
<ul>
<li>You want safety for your methods, but can’t tolerate lock overhead on each method call.</li>
<li>You want fine grained lock control for parallelism.</li>
<li>All your exported methods take <code>&amp;self</code>.</li>
<li>Your <code>NativeClass</code> type is <code>Send + Sync</code>.</li>
</ul>
<h4 id="use-a-localcelldatat-when"><a class="doc-anchor" href="#use-a-localcelldatat-when">§</a>Use a <code>LocalCellData&lt;T&gt;</code> when:</h4>
<ul>
<li>Your <code>NativeClass</code> type is not <code>Send</code>, and you will only ever use it from the thread where
it’s originally created.</li>
</ul>
<h4 id="use-aethert-when"><a class="doc-anchor" href="#use-aethert-when">§</a>Use <code>Aether&lt;T&gt;</code> when:</h4>
<ul>
<li>Your <code>NativeClass</code> type is a zero-sized type (ZST) that is <code>Copy + Default</code>.</li>
<li>You don’t need to do anything special in <code>Drop</code>.</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Aether.html" title="struct gdnative::export::user_data::Aether">Aether</a></div><div class="desc docblock-short">Special user-data wrapper intended for zero-sized types, that does not perform any
allocation or synchronization at runtime. Does not implement <code>MapMut</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.ArcData.html" title="struct gdnative::export::user_data::ArcData">ArcData</a></div><div class="desc docblock-short">User-data wrapper encapsulating a <code>Arc&lt;T&gt;</code>. Does not implement <code>MapMut</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.DefaultLockPolicy.html" title="struct gdnative::export::user_data::DefaultLockPolicy">Default<wbr>Lock<wbr>Policy</a></div><div class="desc docblock-short">Default lock policy that may change in future versions.</div></li><li><div class="item-name"><a class="struct" href="struct.LocalCellData.html" title="struct gdnative::export::user_data::LocalCellData">Local<wbr>Cell<wbr>Data</a></div><div class="desc docblock-short">User-data wrapper analogous to a <code>Arc&lt;RefCell&lt;T&gt;&gt;</code>, that is restricted to the thread
where it was originally created. The destructor of <code>T</code> is not guaranteed to be run if
this is actually shared across multiple threads.</div></li><li><div class="item-name"><a class="struct" href="struct.MutexData.html" title="struct gdnative::export::user_data::MutexData">Mutex<wbr>Data</a></div><div class="desc docblock-short">User-data wrapper encapsulating a <code>Arc&lt;Mutex&lt;T&gt;&gt;</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.Once.html" title="struct gdnative::export::user_data::Once">Once</a></div><div class="desc docblock-short">Special user-data wrapper intended for objects that can only be used once. Only
implements <code>MapOwned</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.RwLockData.html" title="struct gdnative::export::user_data::RwLockData">RwLock<wbr>Data</a></div><div class="desc docblock-short">User-data wrapper encapsulating a <code>Arc&lt;RwLock&lt;T&gt;&gt;</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.ValueTaken.html" title="struct gdnative::export::user_data::ValueTaken">Value<wbr>Taken</a></div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DeadlockPolicy.html" title="enum gdnative::export::user_data::DeadlockPolicy">Deadlock<wbr>Policy</a></div><div class="desc docblock-short">Policies to deal with potential deadlocks</div></li><li><div class="item-name"><a class="enum" href="enum.Infallible.html" title="enum gdnative::export::user_data::Infallible">Infallible</a></div><div class="desc docblock-short">Error type indicating that an operation can’t fail.</div></li><li><div class="item-name"><a class="enum" href="enum.LocalCellError.html" title="enum gdnative::export::user_data::LocalCellError">Local<wbr>Cell<wbr>Error</a></div><div class="desc docblock-short">Error indicating that a borrow has failed.</div></li><li><div class="item-name"><a class="enum" href="enum.LockFailed.html" title="enum gdnative::export::user_data::LockFailed">Lock<wbr>Failed</a></div><div class="desc docblock-short">Error indicating that a lock wasn’t obtained.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.LockOptions.html" title="trait gdnative::export::user_data::LockOptions">Lock<wbr>Options</a></div><div class="desc docblock-short">Trait defining associated constants for locking wrapper options</div></li><li><div class="item-name"><a class="trait" href="trait.Map.html" title="trait gdnative::export::user_data::Map">Map</a></div><div class="desc docblock-short">Trait for wrappers that can be mapped immutably.</div></li><li><div class="item-name"><a class="trait" href="trait.MapMut.html" title="trait gdnative::export::user_data::MapMut">MapMut</a></div><div class="desc docblock-short">Trait for wrappers that can be mapped mutably.</div></li><li><div class="item-name"><a class="trait" href="trait.MapOwned.html" title="trait gdnative::export::user_data::MapOwned">MapOwned</a></div><div class="desc docblock-short">Trait for wrappers that can be mapped once.</div></li><li><div class="item-name"><a class="trait" href="trait.UserData.html" title="trait gdnative::export::user_data::UserData">User<wbr>Data</a></div><div class="desc docblock-short">Trait for customizable user-data wrappers.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.DefaultUserData.html" title="type gdnative::export::user_data::DefaultUserData">Default<wbr>User<wbr>Data</a></div><div class="desc docblock-short">The default user data wrapper used by derive macro, when no <code>user_data</code> attribute is present.
This may change in the future.</div></li></ul></section></div></main></body></html>