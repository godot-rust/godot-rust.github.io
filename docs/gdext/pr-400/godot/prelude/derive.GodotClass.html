<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Derive macro for the `GodotClass` trait on structs."><title>GodotClass in godot::prelude - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-f3501f0f5ae15dfb.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="godot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.71.1 (eb26296b5 2023-08-03)" data-search-js="search-4926e5fc22a5646a.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-f0540c1d82cde29b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc derive"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../godot/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../godot/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In godot::prelude</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Derive Macro <a href="../index.html">godot</a>::<wbr><a href="index.html">prelude</a>::<wbr><a class="derive" href="#">GodotClass</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>#[derive(GodotClass)]
{
    // Attributes available to this derive:
    #[class]
    #[base]
    #[var]
    #[export]
    #[init]
    #[signal]
    #[property]
}
</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Derive macro for <a href="../obj/trait.GodotClass.html">the <code>GodotClass</code> trait</a> on structs.</p>
<p>You must use this macro; manual implementations of the <code>GodotClass</code> trait are not supported.</p>
<h2 id="construction"><a href="#construction">Construction</a></h2>
<p>To generate a constructor that will let you call <code>MyStruct.new()</code> from GDScript, annotate your
struct with <code>#[class(init)]</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[derive(GodotClass)]
#[class(init)]
</span><span class="kw">struct </span>MyStruct {
    <span class="comment">// ...
</span>}</code></pre></div>
<p>The generated <code>init</code> function will initialize each struct field (except the field annotated
with <code>#[base]</code>, if any) using <code>Default::default()</code>. To assign some other value, annotate the
field with <code>#[init(default = ...)]</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[derive(GodotClass)]
#[class(init)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[init(default = <span class="number">42</span>)]
    </span>my_field: i64
}</code></pre></div>
<p>The given value can be any Rust expression that can be evaluated in the scope where you write
the attribute. However, due to limitations in the parser, some complex expressions must be
surrounded by parentheses. This is the case if the expression includes a <code>,</code> that is <em>not</em>
inside any pair of <code>(...)</code>, <code>[...]</code> or <code>{...}</code> (even if it is, for example, inside <code>&lt;...&gt;</code> or
<code>|...|</code>). A contrived example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>    <span class="attr">#[init(default = (HashMap::&lt;i64, i64&gt;::new()))]
    </span><span class="comment">//                             ^ parentheses needed due to this comma</span></code></pre></div>
<h2 id="inheritance"><a href="#inheritance">Inheritance</a></h2>
<p>Unlike C++, Rust doesn’t really have inheritance, but the GDExtension API lets us “inherit”
from a built-in engine class.</p>
<p>By default, classes created with this library inherit from <code>RefCounted</code>.</p>
<p>To specify a different class to inherit from, add <code>#[class(base = Base)]</code> as an annotation on
your <code>struct</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
#[class(base = Node2D)]
</span><span class="kw">struct </span>MyStruct {
    <span class="comment">// ...
</span>}</code></pre></div>
<p>If you need a reference to the base class, you can add a field of type <code>Gd&lt;Base&gt;</code> and annotate
it with <code>#[base]</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
#[class(base = Node2D)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[base]
    </span>base: Gd&lt;Node2D&gt;,
}</code></pre></div>
<h2 id="properties-and-exports"><a href="#properties-and-exports">Properties and exports</a></h2>
<p>In GDScript, there is a distinction between
<a href="https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_basics.html#properties-setters-and-getters">properties</a>
(fields with a <code>get</code> or <code>set</code> declaration) and
<a href="https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_exports.html">exports</a>
(fields annotated with <code>@export</code>). In the GDExtension API, these two concepts are represented with
<code>#[var]</code> and <code>#[export]</code> attributes respectively.</p>
<p>To create a property, you can use the <code>#[var]</code> annotation:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[var]
    </span>my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {}</code></pre></div>
<p>This makes the field accessible in GDScript using <code>my_struct.my_field</code> syntax. Additionally, it
generates a trivial getter and setter named <code>get_my_field</code> and <code>set_my_field</code>, respectively.
These are <code>pub</code> in Rust, since they’re exposed from GDScript anyway.</p>
<p>For technical reasons, an impl-block with the <code>#[godot_api]</code> attribute is required for properties to
work. Failing to include one will cause a compile error if you try to create any properties.</p>
<p>If you want to implement your own getter and/or setter, write those as a function on your Rust
type, expose it using <code>#[func]</code>, and annotate the field with
<code>#[export(get = ..., set = ...)]</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[var(get = get_my_field, set = set_my_field)]
    </span>my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {
    <span class="attr">#[func]
    </span><span class="kw">pub fn </span>get_my_field(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; i64 {
        <span class="self">self</span>.my_field
    }

    <span class="attr">#[func]
    </span><span class="kw">pub fn </span>set_my_field(<span class="kw-2">&amp;mut </span><span class="self">self</span>, value: i64) {
        <span class="self">self</span>.my_field = value;
    }
}</code></pre></div>
<p>If you specify only <code>get</code>, no setter is generated, making the field read-only. If you specify
only <code>set</code>, no getter is generated, making the field write-only (rarely useful). To add a
generated getter or setter in these cases anyway, use <code>get</code> or <code>set</code> without a value:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="comment">// Default getter, custom setter.
    </span><span class="attr">#[var(get, set = set_my_field)]
    </span>my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {
    <span class="attr">#[func]
    </span><span class="kw">pub fn </span>set_my_field(<span class="kw-2">&amp;mut </span><span class="self">self</span>, value: i64) {
        <span class="self">self</span>.my_field = value;
    }
}</code></pre></div>
<p>Alternatively, a property can be manually registered with Godot. This can be useful
when accessing nested structs or when a custom property name is needed.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="comment">// Registers `my_field` as `my_int` with a getter and setter
</span><span class="attr">#[property(name = my_int, <span class="kw">type </span>= i64, get = get_my_field, set = set_my_field)]
</span><span class="kw">struct </span>MyStruct {
    my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {
    <span class="attr">#[func]
    </span><span class="kw">pub fn </span>get_my_field(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; i64 {
        <span class="self">self</span>.my_field
    }

    <span class="attr">#[func]
    </span><span class="kw">pub fn </span>set_my_field(<span class="kw-2">&amp;mut </span><span class="self">self</span>, value: i64) {
        <span class="self">self</span>.my_field = value;
    }
}</code></pre></div>
<p>For exporting properties to the editor, you can use the <code>#[export]</code> attribute:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[export]
    </span>my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {}</code></pre></div>
<p>If you dont also include a <code>#[var]</code> attribute, then a default one will be generated.
<code>#[export]</code> also supports all of GDScript’s annotations, in a slightly different format. The format is
translated from an annotation by following these four rules:</p>
<ul>
<li><code>@export</code> becomes <code>#[export]</code></li>
<li><code>@export_{name}</code> becomes <code>#[export(name)]</code></li>
<li><code>@export_{name}(elem1, ...)</code> becomes <code>#[export(name = (elem1, ...))]</code></li>
<li><code>@export_{flags/enum}(&quot;elem1&quot;, &quot;elem2:key2&quot;, ...)</code>
becomes
<code>#[export(flags/enum = (elem1, elem2 = key2, ...))]</code></li>
</ul>
<p>As an example of some different export attributes:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="comment">// @export
    </span><span class="attr">#[export]
    </span>float: f64,
     
    <span class="comment">// @export_range(0.0, 10.0, or_greater)
    </span><span class="attr">#[export(range = (<span class="number">0.0</span>, <span class="number">10.0</span>, or_greater))]
    </span>range_f64: f64,

    <span class="comment">// @export_file
    </span><span class="attr">#[export(file)]
    </span>file: GodotString,

    <span class="comment">// @export_file(&quot;*.gd&quot;)
    </span><span class="attr">#[export(file = <span class="string">&quot;*.gd&quot;</span>)]
    </span>gdscript_file: GodotString,

    <span class="comment">// @export_flags_3d_physics
    </span><span class="attr">#[export(flags_3d_physics)]
    </span>physics: u32,

    <span class="comment">// @export_exp_easing
    </span><span class="attr">#[export(exp_easing)]
    </span>ease: f64,

    <span class="comment">// @export_enum(&quot;One&quot;, &quot;Two&quot;, &quot;Ten:10&quot;, &quot;Twelve:12&quot;, &quot;Thirteen&quot;)
    </span><span class="attr">#[export(<span class="kw">enum </span>= (One, Two, Ten = <span class="number">10</span>, Twelve = <span class="number">12</span>, Thirteen))]
    </span>exported_enum: i64,

    <span class="comment">// @export_flags(&quot;A:1&quot;, &quot;B:2&quot;, &quot;AB:3&quot;)
    </span><span class="attr">#[export(flags = (A = <span class="number">1</span>, B = <span class="number">2</span>, AB = <span class="number">3</span>))]
    </span>flags: u32,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {}</code></pre></div>
<p>Most values in expressions like <code>key = value</code>, can be an arbitrary expression that evaluates to the
right value. Meaning you can use constants or variables, as well as any other rust syntax you’d like in
the export attributes.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="kw">const </span>MAX_HEALTH: f64 = <span class="number">100.0</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="attr">#[export(range = (<span class="number">0.0</span>, MAX_HEALTH))]
    </span>health: f64,

    <span class="attr">#[export(flags = (A = <span class="number">0b0001</span>, B = <span class="number">0b0010</span>, C = <span class="number">0b0100</span>, D = <span class="number">0b1000</span>))]
    </span>flags: u32,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {}</code></pre></div>
<p>You can specify custom property hints, hint strings, and usage flags in a <code>#[var]</code> attribute using the
<code>hint</code>, <code>hint_string</code>, and <code>usage_flags</code> keys in the attribute:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>godot::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(GodotClass)]
</span><span class="kw">struct </span>MyStruct {
    <span class="comment">// Treated as an enum with two values: &quot;One&quot; and &quot;Two&quot;
    // Displayed in the editor
    // Treated as read-only by the editor
    </span><span class="attr">#[var(
        hint = PROPERTY_HINT_ENUM,
        hint_string = <span class="string">&quot;One,Two&quot;</span>,
        usage_flags = [PROPERTY_USAGE_EDITOR, PROPERTY_USAGE_READ_ONLY]
    </span>)]
    my_field: i64,
}

<span class="attr">#[godot_api]
</span><span class="kw">impl </span>MyStruct {}</code></pre></div>
<h2 id="signals"><a href="#signals">Signals</a></h2>
<p>The <code>#[signal]</code> attribute is accepted, but not yet implemented. See <a href="https://github.com/godot-rust/gdext/issues/8">issue
#8</a>.</p>
<h2 id="running-code-in-the-editor"><a href="#running-code-in-the-editor">Running code in the editor</a></h2>
<p>If you annotate a class with <code>#[class(tool)]</code>, its lifecycle methods (<code>ready()</code>, <code>process()</code> etc.) will be invoked in the editor. This
is useful for writing custom editor plugins, as opposed to classes running simply in-game.</p>
<p>See <a href="../init/trait.ExtensionLibrary.html#method.editor_run_behavior"><code>ExtensionLibrary::editor_run_behavior()</code></a>
for more information and further customization.</p>
<p>This is very similar to <a href="https://docs.godotengine.org/en/stable/tutorials/plugins/running_code_in_the_editor.html">GDScript’s <code>@tool</code> feature</a>.</p>
</div></details></section></div></main></body></html>